<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><title>虚拟机类加载机制 | 程序员工作笔记</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="[object Object]"><meta name="designer" content="minfive"><meta name="keywords" content="前端博客, 前端, 程序员, 前端开发, 全栈开发, react, javascript, Android"><meta name="description" content="日常学习与兴趣交流的个人博客"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="all"><link rel="canonical" href="https://microcodor.github.io/2018/12/10/Android/Part2/JVM/JVM类加载机制/index.html"><link rel="icon" type="image/png" href="http://tva1.sinaimg.cn/crop.0.0.1002.1002.180/86cba9efjw8f3tsubs08fj20ru0rvq48.jpg" sizes="32x32"><link rel="stylesheet" href="/scss/base/index.css"><link rel="alternate" href="/atom.xml" title="微码农"><link rel="stylesheet" href="/scss/views/page/post.css"></head><body ontouchstart><div id="page-loading" class="page page-loading" style="background-image:url(https://blog.static.minfive.com/other/loader.gif)"></div><div id="page" class="page js-hidden"><header class="page__small-header page__header--small"><nav class="page__navbar"><div class="page__container navbar-container"><a class="page__logo" href="/" title="微码农" alt="微码农"><img src="http://tva1.sinaimg.cn/crop.0.0.1002.1002.180/86cba9efjw8f3tsubs08fj20ru0rvq48.jpg" alt="微码农"></a><nav class="page__nav"><ul class="nav__list clearfix"><li class="nav__item"><a href="/" alt="首页" title="首页">首页</a></li><li class="nav__item"><a href="/archives" alt="归档" title="归档">归档</a></li><li class="nav__item"><a href="/about" alt="关于" title="关于">关于</a></li></ul></nav><button class="page__menu-btn" type="button"><i class="iconfont icon-menu"></i></button></div></nav></header><main class="page__container page__main"><div class="page__content"><article class="page__post"><div class="post__cover"><img src="https://upload-images.jianshu.io/upload_images/15405328-1ee675f13c8f7968?imageMogr2/auto-orient/strip%7CimageView2/2/w/500/format/webp" alt="虚拟机类加载机制"></div><header class="post__info"><h1 class="post__title">虚拟机类加载机制</h1><div class="post__mark"><div class="mark__block"><i class="mark__icon iconfont icon-write"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="https://wxdroid.com">蜗牛</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-time"></i><ul class="mark__list clearfix"><li class="mark__item"><span>2018-12-10</span></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-tab"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/tags/JVM/">JVM</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-eye"></i><ul class="mark__list clearfix"><li id="busuanzi_container_page_pv" class="mark__item"><span id="busuanzi_value_page_pv"></span>次</li></ul></div></div></header><div class="post__content"><h2 id="虚拟机类加载机制"><a href="#虚拟机类加载机制" class="headerlink" title="#虚拟机类加载机制"></a>#虚拟机类加载机制</h2><p><strong>虚拟机把描述类的数据从Class文件加载到内存，并对数据进行校验、转换解析和初始化，最终形成可以被Java虚拟机直接使用的Java类型，这就是虚拟机的类加载机制。</strong></p><p>类从被加载到虚拟内存中开始，到卸载内存为止，它的整个生命周期包括了：加载(Loading)、验证(Verification)、准备(Preparation)、解析(Resolution)、初始化(Initialization)、使用(Using)和卸载(Unloading)七个阶段。其中，验证，准备和解析三个部分统称为连接(Linking)。</p><p>###类加载的过程<br>类加载的全过程，加载，验证，准备，解析和初始化这五个阶段。</p><hr><p>####加载<br>在加载阶段，虚拟机需要完成以下三件事情：</p><ul><li>通过一个类的全限定名来获取定义此类的二进制字节流</li><li>将这个字节流所代表的静态存储结构转换为方法区的运行时数据结构</li><li>在Java堆中生成一个代表这个类的java.lang.Class对象，作为方法区这些数据的访问入口</li></ul><p>####验证<br>这一阶段的目的是为了确保Class文件的字节流中包含的信息符合当前虚拟机的要求，并且不会危害虚拟机自身的安全。不同的虚拟机对类验证的实现可能有所不同，但大致上都会完成下面四个阶段的检验过程：文件格式验证、元数据验证、字节码验证和符号引用验证。</p><p><strong>文件格式验证</strong></p><p>第一阶段要验证字节流是否符合Class文件格式的规范，并且能被当前版本的虚拟机处理。</p><p><strong>元数据验证</strong></p><p>第二阶段是对字节码描述的信息进行语义分析，以保证其描述的信息符合Java语言规范的要求。</p><p><strong>字节码验证</strong></p><p>第三阶段时整个验证过程中最复杂的一个阶段，主要工作是数据流和控制流的分析。在第二阶段对元数据信息中的数据类型做完校验后，这阶段将对类的方法体进行校验分析。这阶段的任务是保证被校验类的方法在运行时不会做出危害虚拟机安全的行为。</p><p><strong>符号引用验证</strong></p><p>最后一个阶段的校验发生在虚拟机将符号引用直接转化为直接引用的时候，这个转化动作将在连接的第三个阶段－解析阶段产生。符号引用验证可以看作是对类自身以外（常量池中的各种符号引用）的信息进行匹配性的校验。</p><p>####准备<br>准备阶段是正式为类变量分配内存并设置类变量初始值的阶段，这些内存都将在方法区进行分配。</p><p>####解析<br>解析阶段是虚拟机将常量池的符号引用转换为直接引用的过程。解析动作主要针对类或接口、字段、类方法、接口方法四类符号引用进行。</p><ul><li>类或接口的解析</li><li>字段解析</li><li>类方法解析</li><li>接口方法解析</li></ul><p>####初始化<br>前面的类加载过程中，除了在加载阶段用户应用程序可以通过自定义类加载器参与之外，其余动作完全由Java虚拟机主导和控制。到了初始化阶段，才真正开始执行类中定义的Java程序代码（或者说是字节码）。在准备阶段，变量已经赋过一次系统要求的初始值，而在初始化阶段，则是根据程序员通过程序制定的主观计划去初始化类变量和其他资源，或者说初始化阶段是执行类构造器<clinit>()方法的过程。</clinit></p><h2 id="类加载器"><a href="#类加载器" class="headerlink" title="###类加载器"></a>###类加载器</h2><p>####类与类加载器<br>虚拟机设计团队把类加载阶段中的”通过一个类的全限定名来获取描述此类的二进制字节流”这个动作放到Java虚拟机外部去实现，以便让程序自己决定如何去获取所需的类。实现这个动作的代码模块被称为”类加载器”。</p><p>####双亲委派模型<br>站在Java虚拟机的角度讲，只存在两种不同的类加载器：一种是启动类加载器(Bootstrap ClassLoader)，这个类加载器使用C++语言实现，是虚拟机自身的一部分；另外一种就是所有其他的类加载器，这些类加载器都由Java语言实现，独立于虚拟机外部，并且全部继承自抽象类java.lang.ClassLoader。从Java开发人员的角度来看，类加载器还可以分得更细致一些，绝大部分Java程序都会使用到以下三种系统提供的类加载器：</p><ul><li>启动类加载器</li><li>扩展类加载器</li><li>应用程序类加载器</li></ul><div class="post-announce">感谢您的阅读，本文由 <a href="https://microcodor.github.io">微码农</a> 版权所有。如若转载，请注明出处：微码农（<a href="https://microcodor.github.io/2018/12/10/Android/Part2/JVM/JVM类加载机制/">https://microcodor.github.io/2018/12/10/Android/Part2/JVM/JVM类加载机制/</a>）</div><div class="post__prevs"><div class="post__prev"><a href="/2018/12/10/Android/Part2/JVM/垃圾回收算法/" title="垃圾回收算法"><i class="iconfont icon-prev"></i>垃圾回收算法</a></div><div class="post__prev post__prev--right"><a href="/2018/12/10/Android/Part2/JavaSE/如何表达出Collection及其子类/" title="如何表达出Collection及其子类">如何表达出Collection及其子类<i class="iconfont icon-next"></i></a></div></div></div></article><div id="comment-container"></div></div><aside class="page__sidebar"><form id="page-search-from" class="page__search-from" action="/search/"><label class="search-form__item"><input class="input" type="text" name="search" placeholder="Search..."> <i class="iconfont icon-search"></i></label></form><div class="sidebar__block"><h3 class="block__title">简介</h3><p class="block__text">日常学习与兴趣交流的个人博客</p></div><div class="sidebar__block"><h3 class="block__title">文章分类</h3><ul class="block-list"><li class="block-list-item"><a class="block-list-link" href="/categories/面试/">面试</a><span class="block-list-count">6</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/博客/">博客</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/ReadingNotes/">ReadingNotes</a><span class="block-list-count">11</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/Network/">Network</a><span class="block-list-count">6</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/JavaSE/">JavaSE</a><span class="block-list-count">23</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/JVM/">JVM</a><span class="block-list-count">4</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/Android/">Android</a><span class="block-list-count">60</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/Algorithm/">Algorithm</a><span class="block-list-count">25</span></li></ul></div><div class="sidebar__block"><h3 class="block__title">最新文章</h3><ul class="block-list latest-post-list"><li class="latest-post-item"><a href="/2019/05/07/Android/Part1/DesignPattern/Builder模式/" title="Builder模式"><div class="item__cover"><img src="https://upload-images.jianshu.io/upload_images/15405328-1ee675f13c8f7968?imageMogr2/auto-orient/strip%7CimageView2/2/w/500/format/webp" alt="Builder模式"></div><div class="item__info"><h3 class="item__title">Builder模式</h3><span class="item__text">2019-05-07</span></div></a></li><li class="latest-post-item"><a href="/2019/05/07/Android/Part1/DesignPattern/外观模式/" title="外观模式"><div class="item__cover"><img src="https://upload-images.jianshu.io/upload_images/15405328-1ee675f13c8f7968?imageMogr2/auto-orient/strip%7CimageView2/2/w/500/format/webp" alt="外观模式"></div><div class="item__info"><h3 class="item__title">外观模式</h3><span class="item__text">2019-05-07</span></div></a></li><li class="latest-post-item"><a href="/2019/05/07/Android/Part1/DesignPattern/代理模式/" title="代理模式"><div class="item__cover"><img src="https://upload-images.jianshu.io/upload_images/15405328-1ee675f13c8f7968?imageMogr2/auto-orient/strip%7CimageView2/2/w/500/format/webp" alt="代理模式"></div><div class="item__info"><h3 class="item__title">代理模式</h3><span class="item__text">2019-05-07</span></div></a></li><li class="latest-post-item"><a href="/2019/05/07/Android/Part1/DesignPattern/单例模式/" title="单例模式"><div class="item__cover"><img src="https://upload-images.jianshu.io/upload_images/15405328-1ee675f13c8f7968?imageMogr2/auto-orient/strip%7CimageView2/2/w/500/format/webp" alt="单例模式"></div><div class="item__info"><h3 class="item__title">单例模式</h3><span class="item__text">2019-05-07</span></div></a></li></ul></div><div class="sidebar__block"><h3 class="block__title">文章标签</h3><ul class="block-list tag-list clearfix"><li class="tag-item"><a class="tag-link" href="/tags/Algorithm/">Algorithm</a></li><li class="tag-item"><a class="tag-link" href="/tags/Android/">Android</a></li><li class="tag-item"><a class="tag-link" href="/tags/Hexo/">Hexo</a></li><li class="tag-item"><a class="tag-link" href="/tags/JVM/">JVM</a></li><li class="tag-item"><a class="tag-link" href="/tags/JavaSE/">JavaSE</a></li><li class="tag-item"><a class="tag-link" href="/tags/Network/">Network</a></li><li class="tag-item"><a class="tag-link" href="/tags/ReadingNotes/">ReadingNotes</a></li><li class="tag-item"><a class="tag-link" href="/tags/crontab/">crontab</a></li><li class="tag-item"><a class="tag-link" href="/tags/nginx/">nginx</a></li><li class="tag-item"><a class="tag-link" href="/tags/thinkphp5/">thinkphp5</a></li><li class="tag-item"><a class="tag-link" href="/tags/面试/">面试</a></li></ul></div></aside></main><footer class="page__footer"><section class="footer__top"><div class="page__container footer__container"><div class="footer-top__item footer-top__item--2"><h3 class="item__title">关于</h3><div class="item__content"><p class="item__text">本站是基于 Hexo 搭建的静态资源博客，主要用于分享日常学习、生活及工作的一些心得总结。</p><ul class="footer__contact-info"><li class="contact-info__item"><i class="iconfont icon-address"></i> <span>BeiJing, China</span></li><li class="contact-info__item"><i class="iconfont icon-email2"></i> <span>920379777@qq.com</span></li></ul></div></div><div class="footer-top__item"><h3 class="item__title">友情链接</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="https://wxdroid.com" title="微码农外站" target="_blank">微码农</a></li></ul></div></div><div class="footer-top__item"><h3 class="item__title">构建工具</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="https://hexo.io/" title="Blog Framework" target="_blank">Hexo</a></li></ul></div></div></div></section><section class="footer__bottom"><div class="page__container footer__container"><p class="footer__copyright">© <a href="https://github.com/Mrminfive/hexo-theme-skapp" target="_blank">Skapp</a> 2017 powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, made by <a href="https://github.com/Mrminfive" target="_blank">minfive</a>.</p><ul class="footer__social-network clearfix"><li class="social-network__item"><a href="https://github.com/microcodor" target="_blank" title="github"><i class="iconfont icon-github"></i></a></li><li class="social-network__item"><a href="mailto:920379777@qq.com" target="_blank" title="email"><i class="iconfont icon-email"></i></a></li></ul></div></section></footer><div id="back-top" class="back-top back-top--hidden js-hidden"><i class="iconfont icon-top"></i></div></div><script src="/js/common.js"></script><script src="/js/page/post.js"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="/js/md5.min.js"></script><script>var tags=["JVM"],gitalk=new Gitalk({clientID:"a2eaf80b18ad8401f697",clientSecret:"078b4ed3e989cb28234c0d1485dc788f94853985",repo:"microcodor.github.io",owner:"microcodor",admin:["microcodor"],labels:tags,id:new Date(154442166e4).getTime()>new Date("2018-02-15").getTime()?md5(location.href):location.href});gitalk.render("comment-container")</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>